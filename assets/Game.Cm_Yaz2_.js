import{j as i}from"./jsx-runtime.CRkqtJS5.js";import{R as f}from"./index.B52nOzfP.js";import{_ as w}from"./Settings.Store.C8-u-4gh.js";import{d as N,t as b,F as E}from"./ToastAssets.Bdm7Cuhy.js";import{A as $}from"./SocialIcon.C7nT6lAC.js";import{L as p,_ as y,M as K}from"./GameLoader.CZcqdd8N.js";import{u as g}from"./index.DcIy302Z.js";import{B as M}from"./ButtonPromise.BASp94UI.js";import"./CircleLoading.DnCBQFdf.js";import"./preload-helper.CLcXU_4U.js";const j={},L=async(t,e,n)=>{const o=`${t}-${e}-${n}`;if(j[o])return j[o];const s=new AbortController,r=s.signal,c=setTimeout(()=>s.abort(),5e3);try{const l=await fetch(`/api/${t}/${e}/${n}`,{signal:r});if(clearTimeout(c),!l.ok)throw new Error(`Error ${l.status}: No se pudo obtener las palabras`);const m=await l.json();return j[o]=m,m}catch(l){console.log(l)}},S=async(t,e)=>{try{const n=await L("game",t,e);if(!n||n.length===0)throw new Error("No hay palabras disponibles");const o=Math.floor(Math.random()*n.length);return n[o]}catch(n){return console.log(n),null}},A={},G=async(t,e,n)=>{const o=`${e}-${n}`;if(!A[o]){const s=await L("dic",e,n);A[o]=new Set(s.map(r=>r.toLowerCase()))}return A[o].has(t.toLowerCase())},D=async(t,e)=>{console.log("Preloading data"),await L("dic",t,e)},x={getWord:S,getByLangLength:L,existWord:G,preloadData:D},P=(t,e)=>{let n=Array(t.length).fill("false"),o={};t.split("").forEach(r=>{o[r]=(o[r]||0)+1});for(let r=0;r<t.length;r++)e[r]===t[r]&&(n[r]="true",o[e[r]]-=1);for(let r=0;r<t.length;r++)n[r]==="false"&&o[e[r]]>0&&(n[r]="exist",o[e[r]]-=1);const s=n.every(r=>r==="true");return{result:n,isWin:s}},B=async(t,e,n)=>{const o=p.get(`wordguess-${t}`)?.game||k;if(o?.word==="")try{const s=await x.getWord(e,n);o.word=s}catch(s){console.error("Error fetching word:",s),o.isWin=!1}a.set(o),T(t)},T=t=>{p.set(`wordguess-${t}`,{game:a.get(),setting:w.get()}),p.set("wordguess-user",y.get())},h={compareWord:P,saveLocal:T,validatePrevData:B},k={word:"",guess:"",valid:Array.from({length:6},()=>Array.from({length:5},()=>({letter:"",state:void 0}))),currentRow:0,currentLetter:0,isWin:void 0,waiting:!1},a=N(k),I=t=>{const e=a.get(),n=w.get();if(e.currentLetter>=n.length||e.isWin||e.currentRow>=n.tries)return;e.currentLetter<0?e.currentLetter=0:e.currentLetter>e.valid[0].length-1&&(e.currentLetter=e.valid[0].length-1);const o=e.valid[e.currentRow][e.currentLetter];o.letter=t,o.state=void 0,a.setKey("currentLetter",e.currentLetter+1)},U=()=>{const t=a.get();if(t.currentLetter<=0||t.isWin||t.currentRow>=t.valid.length)return;const e=[...t.valid],n=t.currentLetter-1,s=t.valid[t.currentRow][t.currentLetter]?.letter?t.currentLetter:n;s<0||(e[t.currentRow][s]={letter:"",state:void 0},a.set({...t,currentLetter:s,valid:e}))},V=async t=>{const e={...a.get()},n=w.get();if(e.isWin||e.currentRow>e.valid.length-1)return;const o=e.valid[e.currentRow].every(u=>u.letter),s=document.querySelector(`[data-row="${e.currentRow}"]`),r=u=>{s?.classList.add("error"),b.error(u),setTimeout(()=>{s?.classList.remove("error")},400)};if(!o){r("Field is not complete");return}b.dismiss();const c=e.valid[e.currentRow].map(u=>u.letter).join("");if(!await x.existWord(c,n.lang,n.length)){r("Invalid word");return}const m=h.compareWord(e.word.toUpperCase(),c.toUpperCase());m.result.forEach((u,C)=>{e.valid[e.currentRow][C].state=u}),m.isWin?(a.setKey("isWin",!0),a.setKey("lastPlayed",Date.now()),setTimeout(()=>{a.setKey("waiting",!0)},e.valid[0].length*350)):e.currentRow===e.valid.length-1?(a.setKey("isWin",!1),a.setKey("lastPlayed",Date.now()),setTimeout(()=>{a.setKey("waiting",!0),b.show(e.word)},e.valid[0].length*230)):(e.currentLetter=0,e.currentRow=e.currentRow+1,e.guess="",a.set(e)),h.saveLocal(t)},Y=async t=>{y.get().isPremium||K.decrementGames();const n=p.inmutable(a.get()),o=w.get(),s={...n,...k,valid:Array.from({length:o.tries},()=>Array.from({length:o.length},()=>({letter:"",state:void 0})))},r=await x.getWord(o.lang,o.length);s.word=r,a.set(s),h.saveLocal(t),document.querySelectorAll(".key-box").forEach(l=>l.removeAttribute("data-valid"))},d={typing:I,backspace:U,enter:V,restart:Y},_={send:i.jsx("svg",{height:30,viewBox:"0 -1 24 24",fill:"none",children:i.jsxs("g",{children:[" ",i.jsx("path",{d:"M7 12L9.89075 14.8907V14.8907C9.95114 14.951 10.049 14.9511 10.1094 14.8907V14.8907L17 8",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})," "]})}),backspace:i.jsx("svg",{height:26,viewBox:"0 -1 24 24",fill:"none",children:i.jsxs("g",{children:[i.jsx("path",{d:"M7.91987 5C7.33602 5 6.78132 5.25513 6.40136 5.69842L2.11564 10.6984C1.47366 11.4474 1.47366 12.5526 2.11564 13.3016L6.40136 18.3016C6.78132 18.7449 7.33602 19 7.91987 19L19 19C20.1046 19 21 18.1046 21 17L21 7C21 5.89543 20.1046 5 19 5L7.91987 5Z",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.8"}),i.jsx("path",{d:"M15 10.0001L11 14.0001",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"}),i.jsx("path",{d:"M11 10.0001L15 14.0001",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5"})]})})};function W({id:t}){return _[`${t}`]}function F({path:t}){const e=g(a),[n,o]=f.useState(!1);return f.useEffect(()=>{o(!1),e.isWin!==void 0&&setTimeout(()=>{o(!0)},e.valid[0].length*(e.isWin?350:230))},[e.isWin]),f.useEffect(()=>{e.currentRow>0&&e.currentRow<=e.valid.length&&setTimeout(()=>{for(let s=0;s<e.currentRow;s++)e.valid[s].forEach(c=>{const l=document.querySelector(`[data-letter="${c.letter.toUpperCase()}"]`);l?.getAttribute("data-valid")!=="true"&&l?.setAttribute("data-valid",c.state)})},e.valid[0].length*240)},[e.currentRow]),i.jsxs("section",{className:"f-col w-100 relative mt-3",children:[i.jsxs("div",{className:"keyboard-container f-col",children:[i.jsx("div",{className:"f-row f-center",children:"QWERTYUIOP".split("").map((s,r)=>i.jsx(R,{content:s,onPointer:()=>d.typing(s)},r))}),i.jsxs("div",{className:"f-row f-center",children:["ASDFGHJKL".split("").map((s,r)=>i.jsx(R,{content:s,onPointer:()=>d.typing(s)},r)),i.jsx("span",{className:"key-box-icon d-flex f-center icon w-100 br-4 pointer",onPointerDown:()=>d.backspace(),children:i.jsx(W,{id:"backspace"})})]}),i.jsxs("div",{className:"f-row f-center",children:["ÑZXCVBNM".split("").map((s,r)=>i.jsx(R,{content:s,onPointer:()=>d.typing(s)},r)),i.jsx("span",{className:"key-box-icon d-flex f-center icon w-100 br-4 f-grow pointer",onPointerDown:()=>d.enter(t),children:i.jsx(W,{id:"send"})})]})]}),i.jsx("div",{className:`play-again absolute d-flex f-center h-100 w-100 ${n?"active":""}`,children:i.jsx(M,{className:"btn btn-primary br-6",text:"Play Again",onClick:async()=>{await new Promise(s=>setTimeout(s,500)),d.restart(t)}})})]})}const R=({content:t,onPointer:e,className:n})=>i.jsx("span",{className:`key-box br-4 d-flex f-center pointer fw-500 fs-2 ${n||""}`,onClick:e,"data-letter":t,children:t});function q({state:t}){return g(y),i.jsxs("div",{className:"game-popup p-2 br-8 f-col g-2",children:[i.jsx("h2",{children:t?"You win!":"You lose"}),i.jsx("p",{className:"fs-custom-13-5 fw-500",children:t?"Congratulations!":"Sorry, you lost"})]})}function Z({data:t,index:e,currentLetter:n,currentRow:o}){const s=g(a),r=f.useRef(null);return f.useEffect(()=>{t.state!==void 0?(r?.current?.removeAttribute("data-valid"),r?.current?.removeAttribute("data-win"),r.current?.classList.remove("active"),setTimeout(()=>{r?.current?.classList.add("validate"),setTimeout(()=>{r.current?.setAttribute("data-valid",`${t.state}`),s.isWin&&s.currentRow===o&&setTimeout(()=>{r.current?.setAttribute("data-win","true")},(s?.valid[0].length+1)*120)},180)},e*150)):(r.current?.classList.remove("active"),r.current?.removeAttribute("data-valid"),r.current?.removeAttribute("data-win"))},[t.state]),i.jsx("span",{className:`game-box d-flex br-4 f-center ${n===e?"target":""} ${t.letter?"active":""}`,"data-valid":t.state,style:{pointerEvents:s.isWin!==void 0?"none":"visible",cursor:s.currentRow===o?"pointer":"default"},onClick:()=>{s.isWin===void 0&&s.currentRow===o&&a.setKey("currentLetter",e)},ref:r,children:t.letter})}const v=w.get();function oe({path:t}){const e=g(y),n=g(a);let o=n.valid;const s=async r=>{const c=/^[a-zA-ZñÑ]$/;if(!(n.isWin||n.isWin===!1||n.currentRow===n.valid.length-1))if(c.test(r.key))d.typing(r.key);else if(r.key==="Backspace")d.backspace();else if(r.key==="Enter"){const l=await E.timeTracker(()=>d.enter(t));console.log(l)}else r.key==="ArrowLeft"?a.setKey("currentLetter",a.get().currentLetter-1):r.key==="ArrowRight"&&a.setKey("currentLetter",a.get().currentLetter+1)};return f.useEffect(()=>{if(n.isWin===void 0&&e.remainingGames>0&&(x.preloadData(v.lang,v.length),h.validatePrevData(t,v.lang,v.length),!E.isMobile()))return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[]),f.useEffect(()=>{n.isWin!==void 0&&$.custom(i.jsx(q,{state:n.isWin}),{id:"game-popup",bgClose:!0,animate:"custom",startAnim:{top:"1rem"},endAnim:{top:"-3.5rem"}})},[n.waiting]),i.jsxs("div",{className:"game-board f-col f-align-between mx-auto mt-3",style:{pointerEvents:n.isWin!==void 0?"none":"visible"},children:[o?.map((r,c)=>i.jsx(H,{data:r,currentLetter:n.currentLetter,currentRow:n.currentRow,index:c},c)),i.jsx(F,{path:t})]})}const H=({data:t,currentLetter:e,currentRow:n,index:o})=>i.jsx("div",{className:"f-row f-center","data-row":o,children:t?.map((s,r)=>i.jsx(Z,{data:s,index:r,currentLetter:n===o?e:null,currentRow:o},r))});export{oe as default};
