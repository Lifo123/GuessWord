const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Game.BAcWe8i4.js","assets/jsx-runtime.CRkqtJS5.js","assets/index.B52nOzfP.js","assets/Settings.Store.Ber4ZPNz.js","assets/SocialIcon.C7nT6lAC.js","assets/index.DcIy302Z.js","assets/ButtonPromise.BASp94UI.js","assets/CircleLoading.DnCBQFdf.js","assets/ToastAssets.Bdm7Cuhy.js","assets/preload-helper.CLcXU_4U.js"])))=>i.map(i=>d[i]);
import{_ as R}from"./preload-helper.CLcXU_4U.js";import{j as o}from"./jsx-runtime.CRkqtJS5.js";import{L as h,_ as d}from"./Settings.Store.Ber4ZPNz.js";import{t as f,d as W}from"./ToastAssets.Bdm7Cuhy.js";import{R as j,r as A}from"./index.B52nOzfP.js";import{m as G}from"./SocialIcon.C7nT6lAC.js";import{u as D}from"./index.DcIy302Z.js";function T(){return o.jsx("a",{className:"btn btn-primary br-6",href:"/premium",children:"Upgrade now"})}const w={},p=async(t,e,s)=>{const r=`${t}-${e}-${s}`;if(w[r])return w[r];const n=new AbortController,a=n.signal,u=setTimeout(()=>n.abort(),5e3);try{const c=await fetch(`/api/${t}/${e}/${s}`,{signal:a});if(clearTimeout(u),!c.ok)throw new Error(`Error ${c.status}: No se pudo obtener las palabras`);const g=await c.json();return w[r]=g,g}catch(c){console.log(c)}},S=async(t,e)=>{try{const s=await p("game",t,e);if(!s||s.length===0)throw new Error("No hay palabras disponibles");const r=Math.floor(Math.random()*s.length);return s[r]}catch(s){return console.log(s),null}},y={},N=async(t,e,s)=>{const r=`${e}-${s}`;if(!y[r]){const n=await p("dic",e,s);y[r]=new Set(n.map(a=>a.toLowerCase()))}return y[r].has(t.toLowerCase())},_=async(t,e)=>{console.log("Preloading data"),await p("dic",t,e)},x={getWord:S,getByLangLength:p,existWord:N,preloadData:_},$={user:"",token:"",isLogin:!0,isPremium:!0,remainingGames:1},m=G($),K=()=>{const t=m.get();!t.isPremium&&t.remainingGames>0&&m.setKey("remainingGames",t.remainingGames-1)},U=()=>{const t=m.get();if(!t.isPremium&&t.remainingGames<=1){f.error("You have reached the limit of free games. Upgrade to premium to continue playing!");return}},C={decrementGames:K,isAvailableToPlay:U},P=(t,e)=>{let s=Array(t.length).fill("false"),r={};t.split("").forEach(a=>{r[a]=(r[a]||0)+1});for(let a=0;a<t.length;a++)e[a]===t[a]&&(s[a]="true",r[e[a]]-=1);for(let a=0;a<t.length;a++)s[a]==="false"&&r[e[a]]>0&&(s[a]="exist",r[e[a]]-=1);const n=s.every(a=>a==="true");return{result:s,isWin:n}},k=async(t,e,s)=>{const r=h.get(`wordguess-${t}`)?.game||L;if(r?.word==="")try{const n=await x.getWord(e,s);r.word=n}catch(n){console.error("Error fetching word:",n),r.isWin=!1}i.set(r),b(t)},b=t=>{h.set(`wordguess-${t}`,i.get()),h.set("wordguess-setting",d.get()),h.set("wordguess-user",m.get())},v={compareWord:P,saveLocal:b,validatePrevData:k},L={word:"",guess:"",valid:Array.from({length:d.get()?.tries},()=>Array.from({length:d.get()?.length},()=>({letter:"",state:void 0}))),currentRow:0,currentLetter:0,isWin:void 0,isDaily:!1,waiting:!1},i=W(L),M=t=>{const e=i.get(),s=d.get();if(e.currentLetter>=s.length||e.isWin||e.currentRow>=s.tries)return;e.currentLetter<0?e.currentLetter=0:e.currentLetter>e.valid[0].length-1&&(e.currentLetter=e.valid[0].length-1);const r=e.valid[e.currentRow][e.currentLetter];r.letter=t,r.state=void 0,i.setKey("currentLetter",e.currentLetter+1)},I=()=>{const t=i.get();if(t.currentLetter<=0||t.isWin||t.currentRow>=t.valid.length)return;const e=[...t.valid],s=t.currentLetter-1,n=t.valid[t.currentRow][t.currentLetter]?.letter?t.currentLetter:s;n<0||(e[t.currentRow][n]={letter:"",state:void 0},i.set({...t,currentLetter:n,valid:e}))},V=async t=>{const e={...i.get()},s=d.get();if(e.isWin||e.currentRow>e.valid.length-1)return;const r=e.valid[e.currentRow].every(l=>l.letter),n=document.querySelector(`[data-row="${e.currentRow}"]`),a=l=>{n?.classList.add("error"),f.error(l),setTimeout(()=>{n?.classList.remove("error")},400)};if(!r){a("Field is not complete");return}f.dismiss();const u=e.valid[e.currentRow].map(l=>l.letter).join("");if(!await x.existWord(u,s.lang,s.length)){a("Invalid word");return}const g=v.compareWord(e.word.toUpperCase(),u.toUpperCase());g.result.forEach((l,E)=>{e.valid[e.currentRow][E].state=l}),g.isWin?(i.setKey("isWin",!0),i.setKey("lastPlayed",Date.now()),setTimeout(()=>{i.setKey("waiting",!0)},e.valid[0].length*350)):e.currentRow===e.valid.length-1?(i.setKey("isWin",!1),i.setKey("lastPlayed",Date.now()),setTimeout(()=>{i.setKey("waiting",!0),f.show(e.word)},e.valid[0].length*230)):(e.currentLetter=0,e.currentRow=e.currentRow+1,e.guess="",i.set(e)),v.saveLocal(t)},Y=async t=>{m.get().isPremium||C.decrementGames();const s=h.inmutable(i.get()),r=d.get(),n={...s,...L,valid:Array.from({length:r.tries},()=>Array.from({length:r.length},()=>({letter:"",state:void 0})))},a=await x.getWord(r.lang,r.length);n.word=a,i.set(n),v.saveLocal(t),document.querySelectorAll(".key-box").forEach(c=>c.removeAttribute("data-valid"))},X={typing:M,backspace:I,enter:V,restart:Y},F=j.lazy(()=>R(()=>import("./Game.BAcWe8i4.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])));function Z({path:t}){const e=D(m);return o.jsx(o.Fragment,{children:o.jsx(A.Suspense,{fallback:o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"skeleton p-2 br-8",style:{width:"310px",height:"360px"}}),o.jsx("div",{className:"skeleton p-2 br-8",style:{width:"85%",height:"36px",maxWidth:"400px",animationDelay:".1s"}}),o.jsx("div",{className:"skeleton p-2 br-8",style:{width:"90%",height:"36px",maxWidth:"400px",animationDelay:".2s"}}),o.jsx("div",{className:"skeleton p-2 br-8",style:{width:"85%",height:"36px",maxWidth:"400px",animationDelay:".3s"}})]}),children:e.remainingGames>0?o.jsx(F,{path:t}):o.jsxs("div",{className:"f-col g-2 f-justify-center f-align-center mx-auto",children:[o.jsx("h2",{className:"fs-7 fw-500",children:"You have reached the limit of free games"}),o.jsx("p",{className:"fs-custom-15 m-0",children:e.isLogin?"Upgrade to premium to continue playing":"Login for more free games"}),e.isLogin?o.jsx(T,{}):o.jsx("a",{className:"btn btn-primary br-6 mt-2",onClick:()=>window.location.href="/acc/login",children:"Sign in"})]})})})}export{Z as G,X as M,m as _,i as a,x as b,v as c};
